<?xml version="1.0"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <?define ProductVersion="5.0.1" ?>
  <?define ProductName="Yubico Authenticator" ?>

   <Product Id="*" UpgradeCode="12345678-1234-1234-1234-111111111111" Name="$(var.ProductName)" Version="$(var.ProductVersion)" Manufacturer="Yubico Ab" Language="1033">
      <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" Platform="x64" Description="$(var.ProductName) $(var.ProductVersion)" />
      <Media Id="1" Cabinet="yubioathdesktop.cab" EmbedCab="yes"/>

      <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />

      <UI>
          <UIRef Id="WixUI_InstallDir" />
          <Publish Dialog="WelcomeDlg"
            Control="Next"
            Event="NewDialog"
            Value="InstallDirDlg"
            Order="2">1</Publish>
          <Publish Dialog="InstallDirDlg"
            Control="Back"
            Event="NewDialog"
            Value="WelcomeDlg"
            Order="2">1</Publish>
          <Publish Dialog="ExitDialog"
            Control="Finish" 
            Event="DoAction" 
            Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
      </UI>

      <Directory Id="TARGETDIR" Name="SourceDir">
         <Directory Id="ProgramFiles64Folder" Name="PFiles">
            <Directory Id="YubicoDir" Name="Yubico">
                <Directory Id="INSTALLDIR" Name="Yubico Authenticator">
                </Directory>
            </Directory>
         </Directory>
      </Directory>

      <CustomAction Id="RegisterEXE"
                  Directory="INSTALLDIR"
                  ExeCommand="&quot;vc_redist.x64.exe&quot; /q /norestart"
                  Execute="deferred"
                  Return="ignore"  
                  Impersonate="no"
                 />

      <InstallExecuteSequence>
        <Custom Action='RegisterEXE' After='InstallFiles' />
      </InstallExecuteSequence>

      <Feature Id="DefaultFeature" Level="1">
         <ComponentGroupRef Id="ApplicationFiles"/>
      </Feature>

      <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Launch Yubico Authenticator" />

      <Property Id="WixShellExecTarget" Value="[#fil9AD596424AE112BC3458900952B5BE58]" />
      <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />
   </Product>
</Wix>
